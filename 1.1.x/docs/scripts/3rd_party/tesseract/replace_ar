#!/bin/bash
TMPLIST=`mktemp /tmp/${0##*/}.XXXXX`
TMPFILE=`mktemp /tmp/${0##*/}.XXXXX`
trap 'rm -f $TMPLIST ${TMPFILE}*' 0
#
find . -name Makefile > $TMPLIST
if [ ! -s $TMPLIST ]; then
  echo No files found
  exit 2
fi
for file in `cat $TMPLIST`; do
  sed 's/^AR *=.*/AR = '${MINGW32}'-ar/' $file > ${TMPFILE}.1
  [ $? -ne 0 ] && exit 3
  sed 's/\(.*\)[	 ]\+ld[	 ]\+\(.*\)/\1	'${MINGW32}'-ld \2/' ${TMPFILE}.1 > ${TMPFILE}.2
  [ $? -ne 0 ] && exit 4
  sed 's/\(.*\)[	 ]\+ar[	 ]\+\(.*\)/\1	'${MINGW32}'-ar \2/' ${TMPFILE}.2 > ${TMPFILE}.3
  [ $? -ne 0 ] && exit 5
  sed 's/\(.*\)[	 ]\+ranlib[	 ]\+\(.*\)/\1	'${MINGW32}'-ranlib \2/' ${TMPFILE}.3 > ${TMPFILE}.4
  [ $? -ne 0 ] && exit 6
  diff $file ${TMPFILE}.4 >/dev/null 2>&1
  [ $? -eq 0 ] && continue
  echo "Modifying $file"
  cp ${TMPFILE}.4 $file
  [ $? -ne 0 ] && exit 7
done
exit 0
