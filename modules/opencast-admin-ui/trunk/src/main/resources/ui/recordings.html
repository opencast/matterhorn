<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Recordings in Processing</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- styles -->
    <link href="infusion-1.1.2/fss/css/fss-reset.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-layout.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-text.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-theme-coal.css" rel="stylesheet" type="text/css" />
    <link href="css/admin.css" rel="stylesheet" type="text/css" />
    <link href="css/tablesorter.css" rel="stylesheet" type="text/css" />

    <!-- scripts -->
    <script type="text/javascript" src="infusion-1.1.2/InfusionAll.js"></script>
    <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="js/jquery.xslt.js"></script>
    <script type="text/javascript" src="js/jquery.xslt.js"></script>
    <script type="text/javascript">

      $(document).ready( function() {
        /* Event: Scheduler button clicked */
        $('#button_schedule').click( function() {
          window.location.href = '../../admin/scheduler.html';
        });

        /* Event: Upload button clicked */
        $('#button_upload').click( function() {
          window.location.href = '../../ingest/ui/index.html';
        });
        
        /* Event: Recording State selector clicked */
        $('.state-selector').click( function() {
          $('.state-selector').removeClass('state-selector-active');
          $(this).addClass('state-selector-active');
          injectLoadingAnimation($('#recordings-table-container'));
          var state = $(this).attr('state');
          $('#recordings-table-container').xslt("rest/recordings/"+state, "xsl/recordings_"+state+".xsl", function() {
            // call makeLocaleDateString
          });
          $('#recordingsTable').tablesorter();
          return false;
        })
        displayRecordingStats();
      });

      /**
       * get and display recording statistics
       */
      displayRecordingStats = function() {
        $.getJSON("rest/countRecordings",
        function(data) {
          for (key in data) {
            var elm = $('#count-' + key);
            if (elm) {
              elm.text('(' + data[key] + ')');
            }
          }
        });
      }

      /**
       * convert timestamp to locale date string
       * @param timestamp
       * @return Strng localized String representation of timestamp
       */
      makeLocaleDateString = function(timestamp) {
        var date = new Date();
        date.setTime(timestamp);
        return date.toLocaleString();
      }

      /**
       * inject a 'loading' animation in the specified element
       */
      injectLoadingAnimation = function(elm) {
        anim = document.createElement('div');
        $(anim).addClass('loadingAnimation');
        $(elm).empty().append(anim);
      }

    </script>
  </head>
  <body>
    <!-- fl-centered doesn't work in winXP-IE8 -->
    <div class="fl-container-flex fl-centered fl-theme-coal">
      <ul class="fl-tabs fl-tabs-left">
        <li class="fl-activeTab"><a href="recordings_upcoming.html">Recordings</a></li>
        <li class=""><a href="agents_status.html">Capture Agents</a></li>
      </ul>
      <div id="stage" class="fl-tab-content wu-tab-content fl-fix">

        <!-- recording state selector -->
        <div id="category-select-container">
          <ul class="category-selector">
            <li class="category-selector-item">
              <span class="state-selector" state="all">All <span id="count-total"></span></span>
            </li>
            <li class="category-selector-spacer">
              &#124;
            </li>
            <li class="category-selector-item">
              <span class="state-selector" state="upcoming">Upcoming <span id="count-upcoming"></span></span>
            </li>
            <li class="category-selector-spacer">
              &#124;
            </li>
            <li class="category-selector-item">
              <span class="state-selector" state="capturing">Capturing <span id="count-capturing"></span></span>
            </li>
            <li class="category-selector-spacer">
              &#124;
            </li>
            <li class="category-selector-item">
              <span class="state-selector" state="processing">Processing <span id="count-processing"></span></span>
            </li>
            <li class="category-selector-spacer">
              &#124;
            </li>
            <li class="category-selector-item">
              <span class="state-selector" state="finished">Finished <span id="count-finished"></span></span>
            </li>
            <li class="category-selector-spacer">
              &#124;
            </li>
            <li class="category-selector-item">
              <span class="state-selector" state="failed">Failed <span id="count-errors">()</span></a>
            </li>
          </ul>
        </div>

        <!-- Add/Schedule Buttons -->
        <div id="add-buttons-container">
          <button type="button" id="button_schedule">
            <span class="icon icon-add">&nbsp;</span>
            <span>Schedule Recording</span>
          </button>
          <button type="button" id="button_upload">
            <span class="icon icon-add">&nbsp;</span>
            <span>Upload Recording</span>
          </button>
        </div>

        <!-- recordings table -->
        <div id="recordings-table-container" style="clear:both;">
          <!-- This is where the rendered table goes -->
        </div>
      </div>
    </div>
  </body>
</html>
