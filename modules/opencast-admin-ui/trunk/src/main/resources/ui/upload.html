<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <!------------------------- HEAD ------------------------->
  <head>
    <title>Matterhorn File Ingest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- styles -->
    <link href="infusion-1.1.2/fss/css/fss-reset.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-layout.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-text.css" rel="stylesheet" type="text/css" />
    <link href="infusion-1.1.2/fss/css/fss-theme-coal.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/admin.css" />
    <link rel="stylesheet" type="text/css" href="css/popuphelp.css" />
    <link type="text/css" href="css/upload.css" rel="stylesheet">
    <style type="text/css">
      .container {margin-bottom: 10px;}
      .color-red {color:red;}
      .formField-list {margin-left:5px; margin-right:5px; padding:0px;}
      .formField-list li {margin-bottom: 4px;}
      .formField-label {width:30% !important; text-align:right; margin-right:5px; float:left;}
      .formField {width:440px !important;float:left;}
      .no-bullets li {list-style-type: none;}
      .collapse-control {padding-left:18px;cursor:pointer;background:silver;}
      .collapse-control-closed {background-image:url(img/arrow-right.png);background-position:top left !important; background-repeat:no-repeat;}
      .collapse-control-open {background-image:url(img/arrow-down.png);background-position:top left !important; background-repeat:no-repeat;}
      .titlebar {background-color:silver !important; padding-left:8px;}
      .helpIcon {display:block;float:left;margin-left:5px;width:16px;height:16px;background-image:url(img/help.png);background-position:center center;background-repeat:no-repeat;cursor:pointer;}
    </style>

    <!-- scripts -->
    <script type="text/javascript" src="infusion-1.1.2/InfusionAll.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <script type="text/javascript" src="js/upload.helptexts.json"></script>
    <script type="text/javascript">
      var metadata = {};

      $(function() {
        // Event: Submit button, submit form if no missing inputs
        $('#BtnSubmit').click( function() {
          if (checkRequiredFields()) {
            $('.formField').each( function() {
              metadata[$(this).attr('id')] = $(this).val();
            });
            $('#uploadForm').ajaxSubmit({
              method: 'post',
              iframe : true,
              dataType : 'xml',
              beforeSubmit: function() {
                $('#gray-out').fadeIn('slow');
                $('#upload-notification').fadeIn('fast');
              },
              success : function(responseXML) {
                $('#gray-out').fadeOut('fast');
                $('#upload-notification').fadeOut('fast');
                var media = responseXML.documentElement.getElementsByTagName('media');
                if (media.length > 0) {
                  $('#stage').load('complete.html', function() {
                    for (key in metadata) {
                      if (metadata[key]) {
                        var elm = $('#field-' + key);
                        $(elm).css('display','block')
                        $(elm).children('.fieldValue').text(metadata[key]);
                      }
                    }
                  });
                } else {
                  $('#stage').load('error.html');
                }
              }
            });
          } else {
            $('#container-missingFields').show('fast');
          }
        });

        // Event: collapsable title clicked, de-/collapse collapsables
        $('.collapse-control').click(function() {
          $(this).toggleClass('collapse-control-closed');
          $(this).toggleClass('collapse-control-open');
          $(this).next('.collapsable').toggle('fast');
        });

        // Event: form field changed, check if data for required fields is missing when a input value changes
        $('.requiredField').change( function() {
          checkRequiredFields();
        });

        // Event: Help icon clicked, display help
        $('.helpIcon').click( function() {
          var help = $(this).prev().attr('id');
          $('#helpTitle').text(helpTexts[help][0]);
          $('#helpText').text(helpTexts[help][1]);
          $('#helpBox').css({top:$(this).offset().top, left:$(this).offset().left}).fadeIn('fast');
          return false;
        });

        // Event: clicked somewhere
        $('body').click( function() {
          $('#helpBox').fadeOut('fast');
        });

        // check if data for required fields is missing
        function checkRequiredFields() {
          var missing = false;
          $('.requiredField').each( function() {
            if (!$(this).val()) {
              $('#notification-' + $(this).attr('id')).show();
              $(this).prev('.formField-label').css('color','red');
              missing = true;
            } else {
              $('#notification-' + $(this).attr('id')).hide();
              $(this).prev('.formField-label').css('color','black');
            }
          });
          if (!missing) {
            $('#container-missingFields').hide('fast');
          }
          return !missing;
        }
      });
    </script>
  </head>

  <!------------------------- BODY ------------------------->
  <body>
    <!-- BEGIN of stage -->
    <!-- fl-centered doesn't work in winXP-IE8 -->
    <div class="fl-container-850 fl-theme-coal">
      <ul class="fl-tabs fl-tabs-left" style="background-color: white;">
        <li class="fl-activeTab"><a href="/admin/recordings.html">Recordings</a></li>
        <li class=""><a href="/admin/agents_status.html">Capture Agents</a></li>
      </ul>
      <div id="stage" class="fl-tab-content wu-tab-content fl-fix" style="background:white;">
        <div class="fl-container-800" style="text-align: center;">
          <h2 id="page-title">Upload Recording</h2>
        </div>

        <!-- missing fields notification -->
        <div id="container-missingFields" class="container" style="display:none;">
          <div id="heading-missingFields" class="fl-widget-header warnbox-title">Missing Inputs</div>
          <div id="content-missingFields" class="fl-widget-content warnbox-content">
            <ul>
              <li id="notification-title" class="missing-fields-item">
                <span class="fl-icon inline-icon icon-bullet"></span>Please enter a <a href="javascript:document.uploadForm.title.focus();">title</a> for the recording.
              </li>
              <li id="notification-type" class="missing-fields-item">
                <span class="fl-icon inline-icon icon-bullet"></span>Please select the <a href="javascript:document.getElementById('type').focus();">media file content</a> -- the type of content the media file contains.
              </li>
              <li id="notification-track" class="missing-fields-item">
                <span class="fl-icon inline-icon icon-bullet"></span>Please select a <a href="javascript:document.getElementById('track').focus();">media file</a> to upload.
              </li>
            </ul>
          </div>
        </div>

        <form id="uploadForm" name="uploadForm" action="../ingest/rest/addMediaPackage" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">

          <!-- basic metadata -->
          <div id="container-basicData" class="container fl-widget">
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list">
                <!-- field: Title -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label"><span class="color-red">* </span>Title:</span>
                  <input type="text" class="formField requiredField" id="title" name="title" required="true">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Presenter -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Presenter:</span>
                  <input type="text" class="formField" id="creator" name="creator">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Sponsoring Department -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Sponsoring Department:</span>
                  <input type="text" class="formField" id="contributor" name="contributor">
                  <span class="helpIcon">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- additional metadata -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-titlebar collapse-control collapse-control-closed">Additional Description</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix collapsable" style="display:none;">
              <ul class="no-bullets formField-list">
                <!-- field: Series -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Series:</span>
                  <input type="text" class="formField" id="isPartOf" name="isPartOf">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Subject -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Subject:</span>
                  <input type="text" class="formField" id="subject" name="subject">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Language -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Language:</span>
                  <input type="text" class="formField" id="language" name="language">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Description -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">Description:</span>
                  <textarea class="formField" id="description" name="description" rows="5"></textarea>
                  <span class="helpIcon">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- distribution data -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-header  titlebar">Distribution</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list">
                <!-- field: License -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label"><span class="color-red">* </span>Distribution channel(s):</span>
                  <span id="dist" style="float:left;">
                    <input type="checkbox" checked="true" disabled="true">
                    &nbsp;Matterhorn media module
                  </span>
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: License -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">License:</span>
                  <input type="text" class="formField" id="license" name="license">
                  <span class="helpIcon">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- file upload -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-titlebar titlebar">File Upload</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list">
                <!-- field: Media file content -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label"><span class="color-red">* </span>Media file content:</span>
                  <select name="flavor" id="flavor" class="requiredField" style="float:left;margin:3px;">
                    <option value="">Choose one:</option>
                    <!-- <option value="audio">Audio</option> -->
                    <option value="presenter/source">Presenter (Video)</option>
                    <option value="audience/source">Audience (Video)</option>
                    <option value="presentation/source">Presentation slides (video)</option>
                    <option value="documents/source">Other document (video)</option>
                    <!-- <option value="indefinite/source">Other (video)</option> -->
                  </select>
                  <!-- <input type="hidden" name="flavor" id="flavor" value="presentation/source"> -->
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <!-- field: Media File -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label"><span class="color-red">* </span>Media File:</span>
                  <input type="file" id="track" name="track" class="requiredField" style="float:left;">
                  <span class="helpIcon">&nbsp;</span>
                </li>
                <li class="ui-helper-clearfix">
                  <span class="formField-label">&nbsp;</span>
                  <span>File must be 2GB or less</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- submit/cancel controls -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list">
                <!-- submit / cancal button -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">&nbsp;</span>
                  <button type="button" id="BtnSubmit">Submit</button>
                  <button id="btnCancle" type="button" onclick="history.back();">Cancel</button>
                  <!-- <a href="index.html" style="float:right;">Switch to AJAX upload form</a> -->
                </li>
                <!-- * = required -->
                <li class="ui-helper-clearfix">
                  <span class="formField-label">&nbsp;</span>
                  <span class="color-red">* </span>required
                </li>
              </ul>
            </div>
          </div>
        </form>

        <!-- END of stage -->
      </div>
    </div>

    <div id="gray-out">
      &nbsp;
    </div>
    <div id="upload-notification" style="padding-top:10px;">
      <center>Uploading...</center>
      <div class="loadingAnimation">&nbsp;</div>
    </div>

    <!-- template for the popup help box -->
    <div id="helpBox" class="helpbox" style="display:none;">
      <img src="img/lightbulb.png" alt="help" />
      <div id="helpTitle" style="display:inline;font-weight:bold; margin-left:10px;"></div>
      <div id="helpText" style="padding-left:7px; padding-right:7px; white-space:normal;" />
    </div>

  </body>

</html>
