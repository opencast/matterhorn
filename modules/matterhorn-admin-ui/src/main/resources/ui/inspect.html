<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Inspect Workflow | Opencast Matterhorn</title>
    <link rel="shortcut icon" href="img/favicon.ico">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="css/oc.layout.css" />
    <link rel="stylesheet" type="text/css" href="css/themes/oc.default.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.6.custom.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-opencast-admin/jquery-ui-opencast-admin.css">

    <script type="text/javascript" src="jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="jquery/jquery-ui-1.8.6.custom.min.js"></script>
    <script type="text/javascript" src="trimpath/trimpath-template-1.0.38.js"></script>
    <script type="text/javascript" src="js/oc.utils.js"></script>
    <!--[if IE]><script type="text/javascript" language="javascript" src="js/excanvas.js"></script><![endif]-->
    <script type="text/javascript" language="javascript" src="js/js-class.js"></script>
    <script type="text/javascript" language="javascript" src="js/bluff-min.js"></script>
    <script type="text/javascript" src="js/oc.inspect.js"></script>

    <style>
      #stage {font-family:"Arial","Helvetica","Verdana","sans-serif"; font-size:10px; margin:20px; min-height:100%; padding:0 0 20px;}
      table {font-family:"Arial","Helvetica","Verdana","sans-serif"; font-size:10px; border-top:1px solid silver;}
      .kvtable tr {margin-bottom:3px; border-bottom:1px solid silver;}
      .subtable {border-top:1px solid silver;}
      .subtable tr {margin-bottom:3px; border:none;}
      .td-key {font-weight:bold;text-align:right;vertical-align: top;}
      .td-value {font-weight:normal; text-align:left; padding-left:5px;}
      .unfoldable-tr {cursor:pointer;}
      .unfoldable-tr :hover {background: silver;}
      .unfoldable-content {display:none;}
      .subdetails {float:left;margin-right:5px;margin-top:5px;}
    </style>

    <script type="text/javascript">

      $(document).ready(function() {
        var id = ocUtils.getURLParam('id');
        Opencast.WorkflowInspect.renderDetails(id, 'inspectContainer', 'inspectTemplate');
      });

    </script>
  </head>
  <body>
    <!-- VERSION AND LOGOUT BAR -->
    <div class="layout-page-header oc-ui-version-bar ui-helper-clearfix">
      <div class="layout-inline layout-float-right"><a id="logout" href="/j_spring_security_logout">Log out</a></div>
    </div>
    <!-- BANNER -->
    <div class="layout-page-header">
      <div class="oc-ui-banner layout-inline">
        <div class="oc-ui-cursor">
          <img src="img/MatterhornLogo.png" onclick="document.location='../welcome.html'" alt="Matterhorn Home Page" title="Matterhorn Home Page" width="104" height="72" class="layout-inline" />
          <h1 id="i18n_logo_title" onclick="document.location='recordings.html'" class="layout-inline layout-valign-top">Admin Tools</h1>
        </div>
      </div>
      <div class="layout-page-banner layout-inline layout-float-right">
        <a href="http://www.opencastproject.org">
          <img src="img/OpencastLogo.png" width="143" height="38" alt="Opencast Community Project" title="Opencast Community Project" />
        </a>
      </div>
    </div>
    <!-- PAGE TABS -->
    <div class="layout-page-header">
      <ul class="layout-page-tabs oc-ui-page-tabs">
        <li class="oc-ui-page-tab oc-ui-page-tab-active oc-ui-cursor ui-corner-top" id="i18n_tab_recording" onclick="document.location='recordings.html'">Recordings</li>
        <li class="oc-ui-page-tab oc-ui-cursor ui-corner-top" id="i18n_tab_series" onclick="document.location='series_list.html'">Series</li>
        <li class="oc-ui-page-tab oc-ui-cursor ui-corner-top" id="i18n_tab_agent" onclick="document.location='agents_status.html'">Capture Agents</li>
      </ul>
    </div>
    <div id="stage">
      <a href="javascript:window.history.back();" title="Go Back to Recordings" style="float:right;">Back to Recordings</a>   <!-- maybe we should use cookies to save the last recording view configuration, also for confirmation screens in upload/schedule -->
      <br>
      <div id="inspectContainer"></div>
    </div>

    <!-- TEMPLATE -->
    <textarea id="inspectTemplate" style="display:none;">
      {macro kvtable(obj)}
        <table class="kvtable">
          {for x in obj}
          <tr>
            <td class="td-key">
              ${x_index}
            </td>
            <td class="td-value">
              {if x_index == 'url'}
              <a href="${x}">${x}</a>
              {else}
                ${x}
              {/if}
            </td>
          </tr>
          {/for}
        </table>
      {/macro}
      {macro subtable(obj)}
        <table class="subtable">
          {for x in obj}
          <tr>
            <td class="td-key">
              ${x_index} : 
            </td>
            <td class="td-value">
              {if x_index == 'url'}
              <a href="${x}">${x}</a>
              {else}
                ${x}
              {/if}
            </td>
          </tr>
          {/for}
        </table>
      {/macro}
      <ul>
        <li><a href="#instance">Workflow Instance</a></li>
        <li><a href="#mediapackage">Mediapackage</a></li>
        <li><a href="#operations">Operations</a></li>
        <li><a href="#performance">Performance</a></li>
      </ul>

      <div id="instance">
        <h3>Instance</h3>
        ${kvtable(Opencast.RenderUtils.extractScalars(workflow))}
        <br>
        <h3>Configuration</h3>
        ${kvtable(workflow.config)}
      </div>

      <div id="mediapackage">
        <h3>General</h3>
        ${kvtable(Opencast.RenderUtils.extractScalars(workflow.mediapackage))}
        {if workflow.mediapackage.media.track.length}
        <br>
        <h3>Media</h3>
        <table class="kvtable">
          {for track in workflow.mediapackage.media.track}
          <tr class="unfoldable-tr">
            <td class="td-key">
              ${track.type}
            </td>
            <td class="td-value">
              ${track.mimetype}
              <div class="unfoldable-content">
                ${subtable(Opencast.RenderUtils.extractScalars(track))}
                {if track.audio || track.video}
                  <div>
                    {if track.audio}
                    <div class="subdetails">
                      <h4>Audio</h4>
                      ${subtable(track.audio)}
                    </div>
                    {/if}
                    {if track.video}
                    <div class="subdetails">
                      <h4>Video</h4>
                      ${subtable(track.video)}
                    </div>
                    {/if}
                {/if}
              </div>
            </td>
          </tr>
          {/for}
        </table>
        {/if}
        {if workflow.mediapackage.metadata.catalog.length}
        <br>
        <h3>Metadata</h3>
        <table class="kvtable">
          {for catalog in workflow.mediapackage.metadata.catalog}
          <tr class="unfoldable-tr">
            <td class="td-key">
              ${catalog.type}
            </td>
            <td class="td-value">
              ${catalog.id}
              <div class="unfoldable-content">
                ${subtable(Opencast.RenderUtils.extractScalars(catalog))}
              </div>
            </td>
          </tr>
          {/for}
        </table>
        {/if}
        {if workflow.mediapackage.attachments.length}
        <br>
        <h3>Attachments</h3>
        <table class="kvtable">
          {for item in workflow.mediapackage.attachments}
          <tr class="unfoldable-tr">
            <td class="td-key">
              ${item.type}
            </td>
            <td class="td-value">
              ${item.id}
              <div class="unfoldable-content">
                ${subtable(Opencast.RenderUtils.extractScalars(item))}
              </div>
            </td>
          </tr>
          {/for}
        </table>
        {/if}
      </div>

      <div id="operations">
        <h3>Operations</h3>
        <table class="kvtable">
          {for op in workflow.operations}
          <tr class="unfoldable-tr">
            <td class="td-value" style="font-size: 70%; vertical-align: top;
                {if op.state=='SUCCEEDED'}color:green;{/if}
                {if op.state=='FAILED'}color:red;{/if}
                {if op.state=='PAUSED'}color:orange;{/if}
                {if op.state=='INSTANTIATED'}color:blue;{/if}
              ">
              ${op.state}
            </td>
            <td class="td-key">
              ${op.id}
            </td>
            <td class="td-value">
              ${op.description}
              <div class="unfoldable-content">
                ${subtable(Opencast.RenderUtils.extractScalars(op))}
                {if op.configurations.length != '0'}
                <h4>Parameter</h4>
                ${subtable(op.configurations)}
                {/if}
              </div>
            </td>
          </tr>
          {/for}
        </table>
      </div>

      <div id="performance">
        <canvas id="graph" width="600" height="300"></canvas>
      </div>
    </textarea>
  </body>
</html>
