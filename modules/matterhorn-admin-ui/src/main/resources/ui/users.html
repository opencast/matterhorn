<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <!-- PAGE TITLE -->
    <title id="i18n_window_title">User Manager</title>
    <link rel="shortcut icon" href="img/favicon.ico" />
    <!-- STYLESHEETS -->
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.6.custom.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-opencast-admin/jquery-ui-opencast-admin.css" />
    <link rel="stylesheet" type="text/css" href="css/admin.css" />
    
    <!-- SCRIPTS -->
    <script type="text/javascript" src="jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="jquery/jquery-ui-1.8.5.custom.min.js"></script>
    <script type="text/javascript" src="trimpath/trimpath-template-1.0.38.js"></script>
    <script type="text/javascript">
      var users = null;

      function buildUsersView(data) {
        users = data;
      }

      $(document).ready( function() {
        // Configure the tabs
        $("#tabsWrapper").tabs({
          select: function (event, ui) {
            switch (ui.index) {
              case 0:
                window.location = 'recordings.html';
                return false;
                break;
              case 1:
                window.location = 'series_list.html';
                return false;
                break;
              case 2:
                window.location = 'agents_status.html';
                return false;
                break;
              case 3:
                window.location = 'statistics.html';
                return false;
                break;
              case 4:
                window.location = 'users.html';
                return false;
                break;
            }
          },
          selected: 4
        });

        // Build the view
        var result = TrimPath.processDOMTemplate("usersTemplate");
        $('#usersDiv').html(result);
        
        // Attach actions to the update buttons
        $(".roleButton").each(function (i) {
          $(this).click(function() {
            // POST the role array to /users/[username].json
            var row = $(this).parent().parent();
            var username = this.id.substring(7); // "button_" = 7 characters
            var url = "/users/" + username + ".json";
            var roleArray = $("#text_" + username).val().split(",");
            var roles = "[";
            for(i =0; i < roleArray.length; i++) {
              roles +="\"";
              roles += roleArray[i].trim();
              roles +="\"";
              if(i < roleArray.length -1) {
                roles += ",";
              }
            }
            roles +="]";
            $.ajax({
              url: url,
              type: 'PUT',
              dataType: 'text',
              data: {"roles": roles},
              success: function() {
                row.fadeOut('slow', function() {
                  row.fadeIn();
                });
              }
            });
          });
        });
      });
      
    </script>
    <script type="text/javascript" src="/users/users.json?limit=1000&jsonp=buildUsersView"></script>
  </head>
  <body>
    <div id="pageHeader">
      <span id="currentVersion"></span>
      <a href="/j_spring_security_logout">Log out</a>
      <div class="clear"></div>
    </div>

    <!-- notification that javaScript is disabled -->
    <noscript>
      <div style="border:1px solid red;width:530px;margin:20px;">
        <div style="text-align: left;background:red; color:white;padding-top:2px;padding-bottom:2px;">
          <div class="icon icon-error" style="margin-left:5px;margin-right:5px;">&nbsp;</div>
          JavaScript is disabled
        </div>
        <div style="padding:10px;">
          JavaScript is turned off in your web browser, so this site won't work properly! <br />
          <strong>
            Please turn JavaScript on to use this site, then refresh the page.
          </strong>
        </div>
      </div>
    </noscript>

    <div id="wrapper">
      <div id="header">
        <a href="recordings.html" style="text-decoration: none;">
          <img src="img/MatterhornLogo.png" onclick="document.location='../welcome.html'; return false;" alt="Matterhorn Home Page" title="Matterhorn Home Page" width="104" height="72" align="left" />
          <h1>Admin Tools</h1>
        </a>
        <a href="http://www.opencastproject.org" id="oc-logo">
          <img src="img/OpencastLogo.png" width="143" height="38" alt="Opencast Community Project" title="Opencast Community Project" />
        </a>
        <div class="clear"></div>
      </div>

      <div id="tabsWrapper" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
        <ul id="tabs">
          <li>
            <a href="#recordings" id="i18n_tab_recording">Recordings</a>
          </li>
          <li>
            <a href="#series" id="i18n_tab_series">Series</a>
          </li>
          <li>
            <a href='#agents_status' id="i18n_tab_agent">Capture Agents</a>
          </li>
          <li>
            <a href="#statistics" id="i18n_tab_statistics">Statistics</a>
          </li>
          <li>
            <a href="#users" id="i18n_tab_statistics">Users</a>
          </li>
        </ul>
      </div>
      
      <div id="usersDiv">
      </div>
      
        <!-- CONTENT AREA -->
        <textarea id="usersTemplate" style="display:none;">
          <table id="usersTable" width="100%" style="float:left;">
          <thead>
            <tr>
            <th width="25%" class="ui-widget-header"><div>User Name</div></th>
                <th width="25%" class="ui-widget-header"><div>Roles</div></th>
            </tr>
          </thead>
          <tbody>
            <form>
              {for user in users}
              <tr>
              <td class="ui-state-active">
                ${user.username}
              </td>
              <td class="ui-state-active">
                <input type="text" id="text_${user.username}" size="50" value="{for role in user.roles}${role}{if role_index < (__LIST__role.length - 1)},{/if}  {/for}"/>
                <input type="button" class="roleButton" id="button_${user.username}" value="update"/>
              </td>
              </tr>
              {forelse}
              <tr>
              <td colspan="4" align="center" class="ui-state-active">No internal users defined</td>
              </tr>
              {/for}
            </form>
          </tbody>
          </table>
        </textarea>
      </div><!-- END #tabsWrapper -->
    </div><!-- END #wrapper -->
  </body>
</html>
