<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <!-- HEAD -->
  <head>
    <title>Opencast Matterhorn - Upload Recording</title>
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- styles -->
    <link rel="stylesheet" type="text/css" href="infusion-1.1.2/fss/css/fss-reset.css">
    <link rel="stylesheet" type="text/css" href="infusion-1.1.2/fss/css/fss-layout.css">
    <link rel="stylesheet" type="text/css" href="infusion-1.1.2/fss/css/fss-text.css">
    <link rel="stylesheet" type="text/css" href="infusion-1.1.2/fss/css/fss-theme-coal.css">
    <link rel="stylesheet" type="text/css" href="css/admin.css">
    <link rel="stylesheet" type="text/css" href="css/popuphelp.css">
    <link type="text/css" rel="stylesheet" href="css/upload.css">
    <style type="text/css">
      .container {margin-bottom: 10px;}
      .color-red {color:red;}
      .formField-list {margin-left:5px; margin-right:5px; padding:0px;}
      .formField-list li {margin-bottom: 4px;}
      .formField-label {width: 150px !important; text-align:right; margin-right:1em; float:left;}
      .formField {width:440px !important;float:left;}
      .no-bullets li {list-style-type: none;}
      .collapse-control {padding-left:18px;cursor:pointer;background:silver;}
      .collapse-control-closed {background-image:url(img/arrow-right.png);background-position:center left !important; background-repeat:no-repeat;}
      .collapse-control-open {background-image:url(img/arrow-down.png);background-position:center left !important; background-repeat:no-repeat;}
      .titlebar {background-color:silver !important; padding-left:8px;}
      .helpIcon {display:block;float:left;margin-left:5px;width:16px;height:16px;background-image:url(img/help.png);background-position:center center;background-repeat:no-repeat;cursor:pointer;}
    </style>

    <!-- scripts -->
    <script type="text/javascript" src="infusion-1.1.2/InfusionAll.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="jquery/plugins/jquery.form.js"></script>
    <script type="text/javascript" src="js/upload.helptexts.json"></script>
    <script type="text/javascript" src="js/version.js"></script>
    <script type="text/javascript">
      var metadata = {};

      $(document).ready(function() {
        // Event: Submit button, submit form if no missing inputs
        $('#BtnSubmit').click( function() {
          if (checkRequiredFields()) {
            $('.formField').each( function() {
              metadata[$(this).attr('id')] = $(this).val();
            });
            $('#uploadForm').ajaxSubmit({
              method: 'post',
              iframe : true,
              dataType : 'xml',
              beforeSubmit: function() {
                $('#gray-out').fadeIn('slow');
                $('#upload-notification').fadeIn('fast');
              },
              success : function(responseXML, statusText) {
                alert(statusText);
                $('#gray-out').fadeOut('fast');
                $('#upload-notification').fadeOut('fast');
                var media = responseXML.documentElement.getElementsByTagName('media');
                if (media.length > 0) {
                  $('#stage').load('complete.html', function() {
                    for (key in metadata) {
                      if (metadata[key]) {
                        var elm = $('#field-' + key);
                        $(elm).css('display','block')
                        $(elm).children('.fieldValue').text(metadata[key]);
                      }
                    }
                  });
                } else {
                  $('#stage').load('error.html');
                }
              }
            });
          } else {
            $('#container-missingFields').show('fast');
          }
        });

        // Event: collapsable title clicked, de-/collapse collapsables
        $('.collapse-control').click(function() {
          $(this).toggleClass('collapse-control-closed');
          $(this).toggleClass('collapse-control-open');
          $(this).next('.collapsable').toggle('fast');
        });

        // Event: form field changed, check if data for required fields is missing when a input value changes
        $('.requiredField').change( function() {
          checkRequiredFields();
        });

        // Event: Help icon clicked, display help
        $('.helpIcon').click( function() {
          var help = $(this).prev().attr('id');
          $('#helpTitle').text(helpTexts[help][0]);
          $('#helpText').text(helpTexts[help][1]);
          $('#helpBox').css({top:$(this).offset().top, left:$(this).offset().left}).fadeIn('fast');
          return false;
        });

        // Event: clicked somewhere
        $('body').click( function() {
          $('#helpBox').fadeOut('fast');
        });

        // check if data for required fields is missing
        function checkRequiredFields() {
          var missing = false;
          var wrongtype = false;
          $('.requiredField').each( function() {
            if (!$(this).val()) {
              $('#notification-' + $(this).attr('id')).show();
              if ($('#container-missingFields').is(':visible')) {
                $(this).prev('.formField-label').css('color','red');
              }
              missing = true;
            } else {
              $('#notification-' + $(this).attr('id')).hide();
              $(this).prev('.formField-label').css('color','black');
            }
          });
          // check for right file extension
          if ($('#track').val() != '') {
            var ext = $('#track').val();
            ext = ext.substr(ext.length-3).toLowerCase();
            var right = (ext == 'avi') || (ext == 'mpg') || 
                        (ext == 'mp4') || (ext == 'mkv') ||
                        (ext == 'flv') || (ext == 'mov') ||
                        (ext == 'wmv') || (ext == 'mp3');
            if (!right) {
              $('#notification-track').show();
              wrongtype = true;
            } else {
              $('#notification-track').hide();
              wrongtype = false;
            }
          }
          if (!missing && !wrongtype) {
            $('#container-missingFields').hide('fast');
          }
          return !missing && right;
        }
      });
    </script>
  </head>

  <!-- BODY -->
  <body>
    <div id="pageHeader">
      <div id="currentVersion"></div>
      <div id="newestVersion" style="text-align: right; float: right;"></div>
    </div>

    <!-- notification that javaScript is disabled -->
    <noscript>
      <center>
        <div style="border:1px solid red;width:530px;margin:20px;">
          <div style="text-align: left;background:red; color:white;padding-top:2px;padding-bottom:2px;">
            <div class="icon icon-error" style="margin-left:5px;margin-right:5px;">&nbsp;</div>
            JavaScript is disabled
          </div>
          <div style="padding:10px;">
            JavaScript is turned off in your web browser, so this site won't work properly! <br />
            <strong>
              Please turn JavaScript on to use this site, then refresh the page.
            </strong>
          </div>
        </div>
      </center>
    </noscript>

    <!-- BEGIN of stage -->
    <!-- fl-centered doesn't work in winXP-IE8 -->
    <div class="fl-container-850 fl-theme-coal">
      <div style="margin-top: .5em"><a href="../../welcome.html"><img src="img/MatterhornLogo_80x57.png" alt="Opencast Matterhorn"></a></div>
      <ul class="fl-tabs fl-tabs-left" style="background-color: white;">
        <li class="fl-activeTab"><a href="/admin/">Recordings</a></li>
        <li class=""><a href="/admin/agents_status.html">Capture Agents</a></li>
      </ul>
      <div id="stage" class="fl-tab-content wu-tab-content fl-fix" style="background:white;">
        <div class="fl-container-800" style="text-align: center;">
          <h2 id="page-title">Upload Recording</h2>
        </div>

        <!-- missing fields notification -->
        <div id="container-missingFields" class="container" style="display:none;">
          <div id="heading-missingFields" class="fl-widget-header warnbox-title">Missing Inputs</div>
          <div id="content-missingFields" class="fl-widget-content warnbox-content">
            <ul>
              <li id="notification-title" class="missing-fields-item">
                <!-- <span class="fl-icon inline-icon icon-bullet"></span> -->
                <span style="width:600px;">
                  Please enter a <a href="javascript:document.uploadForm.title.focus();">title</a> for the recording.
                </span>
              </li>
              <!--
              <li id="notification-flavor" class="missing-fields-item">
                <span class="fl-icon inline-icon icon-bullet"></span>Please select the <a href="javascript:document.getElementById('flavor').focus();">media file content</a> - the type of content the media file contains.
              </li>
              -->
              <li id="notification-track" class="missing-fields-item">
                <!-- <span class="fl-icon inline-icon icon-bullet"></span> -->
                <span>
                  Please select a <a href="javascript:document.getElementById('track').focus();">media file</a> to upload. Supported file formats are: .avi, .mp3, .mp4, .mov, .mpg, .mkv, .flv or .wmv.
                </span>
              </li>
            </ul>
          </div>
        </div>

        <form id="uploadForm" name="uploadForm" action="../ingest/rest/addMediaPackage" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">

          <!-- basic metadata -->
          <div id="container-basicData" class="container fl-widget">
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list fl-controls-right">
                <!-- field: Title -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label"><span class="color-red">* </span>Title:</label>
                  <input type="text" class="formField requiredField" id="title" name="title">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: Presenter -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Presenter:</label>
                  <input type="text" class="formField" id="creator" name="creator">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: Sponsoring Department -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Sponsoring Department:</label>
                  <input type="text" class="formField" id="contributor" name="contributor">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- additional metadata -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-titlebar collapse-control collapse-control-closed">Additional Description</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix collapsable" style="display:none;">
              <ul class="no-bullets formField-list fl-controls-right">
                <!-- field: Series -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Series:</label>
                  <input type="text" class="formField" id="isPartOf" name="isPartOf">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: Subject -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Subject:</label>
                  <input type="text" class="formField" id="subject" name="subject">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: Language -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Language:</label>
                  <input type="text" class="formField" id="language" name="language">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: Description -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">Description:</label>
                  <textarea class="formField" id="description" name="description" rows="5"></textarea>
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- distribution data -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-header  titlebar">Distribution</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list fl-controls-right">
                <!-- field: License -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label"><span class="color-red">* </span>Distribution Channel(s):</label>
                  <span id="dist" style="float:left;">
                    <input id="distribution" type="checkbox" checked="checked" disabled="disabled" class="formField" value="Matterhorn media module" style="width: inherit !important;">
                    &nbsp;Matterhorn media module
                  </span>
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
                <!-- field: License -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">License:</label>
                  <input type="text" class="formField" id="license" name="license">
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- file upload -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="heading-additionalData" class="fl-widget-titlebar titlebar">File Upload</div>
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list fl-controls-right">
                <!-- field: Media file content -->
                <!--
                <li class="ui-helper-clearfix">
                  <span class="formField-label"><span class="color-red">* </span>Media file content:</span>
                  <select name="flavor" id="flavor" class="requiredField" style="float:left;margin:3px;">
                    <option value="">Choose one:</option>
                    <option value="audio">Audio</option>
                    <option value="presenter/source">presenter</option>
                    <option value="audience/source">audience</option>
                    <option value="presentation/source">presentation slides</option>
                    <option value="documents/source">other</option>
                    <option value="indefinite/source">other (video)</option>
                  </select>
                  <span class="helpIcon" title="Click for help">&nbsp;</span>
                  <br>
                </li> -->
                <!--<li class="ui-helper-clearfix">
                  <span class="formField-label">&nbsp;</span>
                  <span style="float:left;">File must contain video.</span>
                </li>-->
                <!-- field: Media File -->
                <li class="ui-helper-clearfix">
                  <input type="hidden" class="formField" name="flavor" id="flavor" value="presentation/source">
                  <label class="fl-label"><span class="color-red">* </span>Media File:</label>
                  <input type="file" id="track" name="track" class="requiredField mouseover-pointer" style="float:left;">
                  <span class="helpIcon"  title="Click for help">&nbsp;</span>
                </li>
                <li class="ui-helper-clearfix">
                  <label class="fl-label">&nbsp;</label>
                  <span style="float:left;" title="Click for help" class="instruction-text">File must be 2GB or less</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- submit/cancel controls -->
          <div id="container-additionalData" class="container fl-widget">
            <div id="content-basicData" class="fl-widget-content ui-helper-clearfix">
              <ul class="no-bullets formField-list fl-controls-right">
                <!-- submit / cancal button -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label" style="float:left;">&nbsp;</label>
                  <span class="fl-fix instruction-text" style="float:right; width:560px;margin-bottom:20px;">NOTE: Information entered here (for an Uploaded Recording) cannot be edited after it is submitted in this version of Matterhorn.</span>
                </li>
                <li class="ui-helper-clearfix">
                  <label class="fl-label">&nbsp;</label>
                  <button type="button" id="BtnSubmit" class="mouseover-pointer control-button">Submit</button>
                  <button id="btnCancle" type="button" onclick="history.back();" class="mouseover-pointer control-button">Cancel</button>
                  <!-- <a href="index.html" style="float:right;">Switch to AJAX upload form</a> -->
                </li>
                <!-- * = required -->
                <li class="ui-helper-clearfix">
                  <label class="fl-label">&nbsp;</label>
                  <span class="color-red">* </span>required
                </li>
              </ul>
            </div>
          </div>
        </form>

        <!-- END of stage -->
      </div>
    </div>

    <div id="gray-out">
      &nbsp;
    </div>
    <div id="upload-notification" style="padding-top:10px;">
      <center>Uploading...</center>
      <div class="loadingAnimation">&nbsp;</div>
    </div>

    <!-- template for the popup help box -->
    <div id="helpBox" class="helpbox" style="display:none;">
      <img src="img/lightbulb.png" alt="help" >
      <div id="helpTitle" style="display:inline;font-weight:bold; margin-left:10px;"></div>
      <div id="helpText" style="padding-left:7px; padding-right:7px; white-space:normal;"></div>
    </div>

  </body>

</html>
