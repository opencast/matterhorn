<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <!------------------------- HEAD ------------------------->
  <head>
    <title>Opencast Matterhorn Search</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="shortcut icon" href="shared_img/favicon.ico"> 
    <!-- styles -->
    <link rel="stylesheet" type="text/css" href="infusion-1.1.2/fss/css/fss-reset.css" />

    <link rel="stylesheet" type="text/css"
          href="infusion-1.1.2/fss/css/fss-layout.css" />
    <link rel="stylesheet" type="text/css"
          href="infusion-1.1.2/fss/css/fss-text.css" />
    <link rel="stylesheet" type="text/css"
          href="infusion-1.1.2/fss/css/fss-theme-mist.css" />
    <link rel="stylesheet" type="text/css" href="css/oc.search.browse.css" />
    <link rel="stylesheet" type="text/css" href="css/oc.pager.css" />
    <link rel="stylesheet" type="text/css" href="shared_css/shared.css">

    <!-- scripts -->
    <script type="text/javascript" src="jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="jquery/plugins/jquery.xslt.js"></script>
    <script type="text/javascript" src="js/oc-pager.js"></script>
    <script type="text/javascript" src="js/engage-ui.js"></script>
    <script type="text/javascript" src="shared_js/version.js"></script>
    <script type="text/javascript">
      $(document).ready( function() {

        var page = Opencast.pager.getCurrentPageID();
        var searchQuery = Opencast.pager.getCurrentSearchQuery();
        var restEndpoint = "../../search/rest/episode?";

        var keywordString = "";
        
        if(searchQuery != null && searchQuery != "") {
          restEndpoint = restEndpoint + "q="+searchQuery+"&";

          // replace all occurences of + by a space
          searchQuery = searchQuery.replace(/\+/g," ");

          keywordString = " for  &#8220;" + unescape(searchQuery) +"&#8221;";
          
          $('#searchField').attr("value", unescape(searchQuery));
          
        }

        restEndpoint = restEndpoint + "limit=10";

        restEndpoint = restEndpoint + "&offset=" + (page - 1) * 10;

        $('#stage').xslt(restEndpoint, "xsl/episodes.xsl", function() {
          Opencast.pager.renderPager();

          var total =  $('#oc-episodes-total').html()
          var toIndex = parseInt($('#oc-episodes-limit').html()) +  (page - 1) * 10;
          var fromIndex = Math.min(parseInt($('#oc-episodes-offset').html()) + 1, toIndex);
          
          $('#title').html("Results "+ fromIndex + "-"+ toIndex + " of "+ total + keywordString);
        });

        if(searchQuery != null && searchQuery != ""){
          $('#rsslink').attr("href", "/feeds/rss/2.0/custom/" + searchQuery);
          $('#atomlink').attr("href", "/feeds/atom/0.3/custom/" + searchQuery);
        } else {
          $('#rsslink').attr("href", "/feeds/rss/2.0/latest");
          $('#atomlink').attr("href", "/feeds/atom/0.3/latest");
        }
      });

    </script>

  </head>

  <!------------------------- BODY ------------------------->
  <body>
	<div id="pageHeader">
      <div id="currentVersion"></div>
      <div id="newestVersion" style="text-align: right; float: right;"></div>
    </div>

    <noscript>
      <p style="color: red;">JavaScript is turned off in your web browser,
        so this site won't work properly! <br />
        <strong>Please turn JavaScript on to use this site, then
          refresh the page.</strong></p>
    </noscript>

    <div class="oc-holder">
      <div style="margin-top: .5em">
        <a href="../../welcome.html" style="color:#F6921E;text-decoration: none;">
          <h1><img src="shared_img/MatterhornLogo_80x57.png" alt="Opencast Matterhorn">&nbsp;&nbsp;Opencast Matterhorn</h1>
        </a>
      </div>
      <div class="oc-search-bar-holder fl-helper-clearfix">&nbsp;
        <div class="oc-search-bar">
          <form action="index.html"><input id="searchField" type="text"
                                           name="q" value="" /> <input type="submit" value="Search" /></form>
          <a id="rsslink" href="/feeds/rss/2.0/latest">RSS</a>&nbsp;|&nbsp;
          <a id="atomlink" href="/feeds/atom/0.3/latest">ATOM</a>&nbsp;|</div>

      </div>
      <div class="oc-search-result-header">
        <h2 id="title">Results</h2>
        <div class="oc-sort-controls"></div>
      </div>
      <div class="oc-search-result-items">
        <div id="stage">loading results...</div>
        <div class="oc-pager">
          <ul id="navigation">
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
