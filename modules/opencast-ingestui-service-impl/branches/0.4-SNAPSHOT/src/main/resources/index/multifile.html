<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

    <head>
    <title>AJAX multi-file upload</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- ------------------------- Style --------------------------------------- -->

    <style type="text/css">

        .addFileButton-container 
        {
            position:relative;
            overflow:hidden;
        }

        .fileSelector
        {
            position:absolute;
            z-index: 5;
            -moz-opacity: 0;
            filter: alpha(opacity:0);
            opacity: 0;
        }

        .addFileButton {width:100px; height:25px; top:0; left:0;}

        .fileList {
            width: 400px;
            position: relative;
        }

        .fileListItemTemplate {
            display:none;
        }

        .fileListItem {
            position: relative;
            width:400px;
            padding:2px;
            border:1px solid silver;
        }

        .fileListItemFilename {
            display:inline-block;
            min-width:330px;
            max-width:330px;
            width:330px;
            overflow:hidden;
        }

        .fileListRemove {
            width:65px;
        }

    </style>

<!-- ------------------------- Script -------------------------------------- -->

    <script type="text/javascript">
        
        nextFileNumber = 1;
        displayForm = true;

        function fileSelected( fileInput ) {
            // clone file input / replace with new file input
            var newFileInput = fileInput.cloneNode(false);
            newFileInput.setAttribute("id", fileInput.getAttribute("id"));
            fileInput.parentNode.replaceChild(newFileInput, fileInput);
            
            // move file input to delivery form
            var fileNumber = nextFileNumber++;
            fileInput.setAttribute("id", "file_" + fileNumber);
            document.mediapackage.appendChild( fileInput );

            // add entry in file list
            addFileToList(fileInput.value, fileNumber, "fileList");

            fileInput.setAttribute("class", "");    // so that one can see the element has been moved
        }

        // clones the fileListItemTemplate, fills in the path, puts it into the specified fileList
        function addFileToList( path, number, listname ) {
            var fileList = document.getElementById(listname);
            var entry = document.getElementById("fileListItemTemplate").cloneNode(true);
            entry.setAttribute("class", "fileListItem");
            entry.setAttribute("id", "fileListItem_"+number);
            entry.getElementsByTagName("div")[0].innerHTML = path;
            entry.getElementsByTagName("button")[0].setAttribute("onclick", "removeFile("+ number +");");
            fileList.appendChild(entry);
        }

        // removes item from the list
        function removeFromFileList(number) {
            var entry = document.getElementById("fileListItem_" + number);
            entry.parentNode.removeChild(entry);
        }

        // removes file input from mediapackage form
        function removeFile( fileNumber ) {
            var file = document.getElementById("file_" + fileNumber);
            file.parentNode.removeChild(file);
            removeFromFileList(fileNumber);
        }

    </script>

  </head>

<!-- --------------------------- Body -------------------------------------- -->

  <body>

      <p>
        List of files:
        <div id="fileList" class="fileList">

            <!-- This is the template for the file list entries -->
            <div id="fileListItemTemplate" class="fileListItemTemplate">
                <div class="fileListItemFilename">Blup</div>
                <button type="button" class="fileListRemove">remove</button>
            </div>

        </div>

        <!-- This is the "add file" button -->
        <div class="addFileButton-container addFileButton">
            <button id="addFileButton" type="button" class="addFileButton">Add file</button>
            <input id="selector" type="file" class="fileSelector addFileButton"  onchange="fileSelected(this);">
        </div>
      </p>

      <!-- The mediapackage form will be populated with the <input type="file">s.
           When the user selects a file the input DOM element is moved into the mediapackage form -->
      <div id="mediapackage-container" style="border:1px solid black; position:relative; width:30em;">
          This is the form that will be submitted:
          <form id="mediapackage" name="mediapackage" action="ingest/upload" method="POST" enctype="multipart/form-data">
              <!-- this is where all the data and file inputs are placed when
                   the mediapackage is created -->
              <input type="hidden" name="jobID" id="jobID" value="">
          </form>
      </div>

  </body>
</html>
